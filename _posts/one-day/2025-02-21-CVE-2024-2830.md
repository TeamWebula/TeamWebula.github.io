---
title: "[CVE-2024-2830] ì·¨ì•½ì  ë¶„ì„ ë³´ê³ ì„œ"
date: 2025-02-21 21:14:00 +0900
author: rlaaudrb1104
categories: [One-Day ë¶„ì„, WordPress]
tags: [ë¹¡ê³µíŒŸ,ì½˜í…ŒìŠ¤íŠ¸ ë„¤ë·¸ë¼,WordPress, GiveWP, CVE-2024-2830, XSS]
image: assets/img/wordpress-thumbnail.png
exclude_img: true
---

> ## **ğŸ’¡ ìš”ì•½**  
> **CVE-2024-2830**ì€ WordPressì˜ Tag and Category Manager - AI Autotagger í”ŒëŸ¬ê·¸ì¸ì—ì„œ ë°œê²¬ëœ **ì €ì¥í˜• í¬ë¡œìŠ¤ ì‚¬ì´íŠ¸ ìŠ¤í¬ë¦½íŒ…(Stored Cross-Site Scripting, XSS)** ì·¨ì•½ì ì…ë‹ˆë‹¤.
> í•´ë‹¹ ì·¨ì•½ì ì€ í”ŒëŸ¬ê·¸ì¸ì˜ `st_tag_cloud` ìˆì½”ë“œì—ì„œ ì‚¬ìš©ì ì…ë ¥ì— ëŒ€í•œ ì¶©ë¶„í•œ ê²€ì¦ê³¼ ì¶œë ¥ ì´ìŠ¤ì¼€ì´í”„ ì²˜ë¦¬ê°€ ì´ë£¨ì–´ì§€ì§€ ì•Šì•„ ë°œìƒí•©ë‹ˆë‹¤. 

## 1. ì·¨ì•½ì  ê°œìš”

- **ì·¨ì•½ì  ë²ˆí˜¸:** CVE-2024-2830  
- **ì˜í–¥ ë°›ëŠ” ë²„ì „:** Tag and Category Manager â€“ AI Autotagger (TaxoPress) 3.13.0 ì´í•˜
- **ì·¨ì•½ì  ìœ í˜•:** Stored XSS
- **CVSS:** 6.4
- **ì·¨ì•½ì  íŒ¨ì¹˜ ë²„ì „:** 3.20.0

## 2. Shortcode ë€?

- WordPress ì—ì„œ `[ ]` ë¡œ ë¬¶ì¸ íŠ¹ìˆ˜ íƒœê·¸ë¡œ, ì½”ë“œ ì—†ì´ë„ ë™ì ì¸ ì½˜í…ì¸ ë¥¼ ì‰½ê²Œ ì¶”ê°€í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” ê¸°ëŠ¥ì…ë‹ˆë‹¤.
    - ex. `[shortcode_tag]`, `[shortcode_tag]content[/shortcode_tag]`
- ShortcodeëŠ” ì£¼ë¡œ ì‚¬ìš©ìê°€ ì œê³µí•œ ì†ì„± ê°’ì´ë‚˜ ì½˜í…ì¸ ì—ì„œ ì…ë ¥ì„ ë°›ì•„ ì²˜ë¦¬í•©ë‹ˆë‹¤. ì´ ì…ë ¥ê°’ì´ ì ì ˆíˆ ê²€ì¦ë˜ì§€ ì•Šê±°ë‚˜ HTML ì´ìŠ¤ì¼€ì´í”„ ì²˜ë¦¬ê°€ ì—†ì„ ê²½ìš° XSS ì·¨ì•½ì ì´ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## 3. ì·¨ì•½ì  ìƒì„¸ ë¶„ì„
### 3.1 class.client.tagcloud.php
```php
public function __construct() {
		if ( 1 === (int) SimpleTags_Plugin::get_option_value( 'allow_embed_tcloud' ) ) {
			add_shortcode( 'st_tag_cloud', array( __CLASS__, 'shortcode' ) );
			add_shortcode( 'st-tag-cloud', array( __CLASS__, 'shortcode' ) );
		}
	}
	
public static function shortcode( $atts ) {
    $atts = shortcode_atts( array( 'param' => '' ), $atts );
		extract( $atts );

		$param = html_entity_decode( $param );
		$param = trim( $param );

		if ( empty( $param ) ) {
			$param = 'title=';
		}

		return self::extendedTagCloud( $param, false );
	}
```
**`__construct()` í•¨ìˆ˜**

Shortcodeë¡œ `[st_tag_cloud]`, `[st-tag-cloud]`ë¥¼ ë“±ë¡í•©ë‹ˆë‹¤. ì´ ë‘ Shortcode ëª¨ë‘ `shortcode()` í•¨ìˆ˜ë¥¼ ì½œë°± í•¨ìˆ˜ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.

**`shortcode()` í•¨ìˆ˜**

ì‚¬ìš©ì ì œê³µ ì†ì„±(`$atts`)ì™€ ê¸°ë³¸ ì†ì„±ì„ ë³‘í•©í•˜ê³ , ì´ë•Œ ê¸°ë³¸ ì†ì„±ì€ `param=â€™â€™` ì…ë‹ˆë‹¤. Shortcodeì— ë‹¤ë¥¸ ì†ì„±ì´ ì œê³µë˜ì§€ ì•Šìœ¼ë©´ `param`ì€ ë¹ˆ ë¬¸ìì—´ë¡œ ì´ˆê¸°í™” ë©ë‹ˆë‹¤.

```php
$atts = shortcode_atts( array( 'param' => '' ), $atts );
```
`extract()` í•¨ìˆ˜ë¥¼ í†µí•´ `$atts` ë°°ì—´ì˜ í‚¤ë¥¼ ë³€ìˆ˜ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.
ë˜í•œ, `$atts`ì— `param` í‚¤ê°€ ìˆë‹¤ë©´ `$param` ë³€ìˆ˜ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.
```php
extract( $atts );
```
`$param`ê°’ì„ ë””ì½”ë”©í•˜ì—¬ HTML ì—”í„°í‹°ë¥¼ ì›ë˜ ë¬¸ìë¡œ ë³€í™˜í•©ë‹ˆë‹¤.

```php
$param = html_entity_decode( $param );
```

`$param`ì—ì„œ ì•ë’¤ ê³µë°±ì„ ì œê±°í•©ë‹ˆë‹¤.

```php
$param = trim( $param );
```
`$param`ì´ ë¹„ì–´ ìˆë‹¤ë©´ ê¸°ë³¸ê°’ `title=` ì„ ì„¤ì •í•©ë‹ˆë‹¤.
```php
if ( empty( $param ) ) {
    $param = 'title=';
}
```
ìµœì¢…ì ìœ¼ë¡œ `$param`ê°’ì„ `extendedTagCloud` í•¨ìˆ˜ì— ì „ë‹¬í•˜ì—¬ íƒœê·¸ í´ë¼ìš°ë“œë¥¼ ìƒì„±í•©ë‹ˆë‹¤.

```php
return self::extendedTagCloud( $param, false );
```

```php
class SimpleTags_Client_TagCloud {
			...
			...
			// Get terms
			$terms = self::getTags( $args, $taxonomy );
			extract( $args ); // Params to variables
	
			// If empty use default xformat !
			if ( empty( $xformat ) ) {
				$xformat = $defaults['xformat'];
			}
	
			$xformat = taxopress_sanitize_text_field($xformat);
	
	        //remove title if in settings
	        if((int)$hide_title > 0){
	            $title = '';
	        }
        
      $term = $terms_data[ $term_name ];
			$scale_result = (int) ( $scale <> 0 ? ( ( $term->count - $minval ) * $scale + $minout ) : ( $scale_max - $scale_min ) / 2 );
			$output[] = SimpleTags_Client::format_internal_tag( $xformat, $term, $rel, $scale_result, $scale_max, $scale_min, $largest, $smallest, $unit, $maxcolor, $mincolor );
		}

		return SimpleTags_Client::output_content( 'st-tag-cloud', $format, $title, $output, $copyright, '', $wrap_class, $link_class, $before, $after );
...
```
`$title`ì€ íƒœê·¸ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” `getTags()` í˜¸ì¶œì˜ ê²°ê³¼ì— ë”°ë¼ ë‘ ê°€ì§€ ê²½ë¡œë¡œ  `SimpleTags_client::output_content()`í•¨ìˆ˜ë¡œ ì „ë‹¬ë©ë‹ˆë‹¤.

### 3.2 class.client.php

```php
	public static function output_content( $html_class = '', $format = 'list', $title = '', $content = '', $copyright = true, $separator = '', $div_class = '', $a_class = '', $before = '', $after = '') {
		if ( empty( $content ) ) {
			return ''; // return nothing
		}

		if ( $format == 'array' && is_array( $content ) ) {
			return $content; // Return PHP array if format is array
		}

		if ( is_array( $content ) ) {
			switch ( $format ) {
				case 'list' :
					$output = ''. $before .' <ul class="' . $html_class . '">' . "\n\t" . '<li>' . implode( "</li>\n\t<li>", $content ) . "</li>\n</ul> {$after}\n";
					break;
				case 'ol' :
					$output = ''. $before .' <ol class="' . $html_class . '">' . "\n\t" . '<li>' . implode( "</li>\n\t<li>", $content ) . "</li>\n</ol> {$after}\n";
					break;
				default :
					$output = '<div class="' . $html_class . '">'. $before .' ' . "\n\t" . implode( "{$separator}\n", $content ) . " {$after}</div>\n";
					break;
			}
		} else {
			$content = trim( $content );
			switch ( $format ) {
				case 'string' :
					$output = $content;
					break;
				case 'list' :
					$output = ''. $before .' <ul class="' . $html_class . '">' . "\n\t" . '<li>' . $content . "</li>\n\t" . "</ul> {$after}\n";
					break;
				default :
					$output = '<div class="' . $html_class . '">'. $before .' ' . "\n\t" . $content . " {$after} </div>\n";
					break;
			}
		}
```
`$title`ì€ ì„ í–‰ ë° í›„í–‰ ê³µë°± ì œê±°(`trim()`), ìƒˆë¡œìš´ ì¤„ ë° íƒ­ ë¬¸ì ì—°ê²° ê³¼ì •ì„ ê±°ì³ ìµœì¢…ì ìœ¼ë¡œ HTML ì¶œë ¥ì˜ ì¼ë¶€ë¡œ í¬í•¨ë˜ì–´ `$title`ê°’ì„ í¬í•¨í•œ ìµœì¢… HTMLì„ ë°˜í™˜í•©ë‹ˆë‹¤.

ë”°ë¼ì„œ `$param` â†’ `$args` â†’ `$title` ë¡œ ì´ì–´ì§€ëŠ” ë°ì´í„° íë¦„ì—ì„œ ì‚¬ìš©ì ì…ë ¥ì— ëŒ€í•œ ìœ íš¨ì„± ê²€ì‚¬ê°€ ì´ë£¨ì–´ì§€ì§€ ì•Šì•„ Stored XSS ì·¨ì•½ì ì´ ë°œìƒí•©ë‹ˆë‹¤.

## 4. PoC

1. `$param` ê°’ì´ ê²€ì¦ ì—†ì´ `shortcode`ì˜ ì¸ìë¡œ ì „ë‹¬
2. HTML ì—”í„°í‹°ê°€ `html_entity_decode()` ë¡œ ì¸í•´ ë³µì›ë˜ê¸° ë•Œë¬¸ì— `<` ì™€ `>` ê°™ì€ íƒœê·¸ ë¬¸ì ì‚½ì… ê°€ëŠ¥
ìœ„ ë‘ ê°€ì§€ ìš”ì†Œ ë•Œë¬¸ì— Contributor ê¶Œí•œ ì‚¬ìš©ìëŠ” ShortCode ë¥¼ ì¶”ê°€í•  ë•Œ Stored XSS ê³µê²©ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆê²Œ ë©ë‹ˆë‹¤.

**í˜ì´ë¡œë“œ**
```
[st_tag_cloud param="title=<script>alert('XSS')</script>"]
```

### 4.1 ê³µê²© ì‹œë‚˜ë¦¬ì˜¤
1. Contributor ê¶Œí•œ ì‚¬ìš©ìê°€ Shortcodeë¥¼ ì¶”ê°€í• ë•Œ param ì†ì„±ì— XSS í˜ì´ë¡œë“œë¥¼ í¬í•¨í•©ë‹ˆë‹¤.

![image.png](assets/posts/one-day/2025-02-21/image-005.png)

2. ë‚´ë¶€ì ìœ¼ë¡œ Shortcodeë¥¼ ì²˜ë¦¬í•˜ë©´ì„œ `html_entity_decode()` HTML ì—”í„°ë””ê°€ ë³µì›ë˜ì–´ ê²°ê³¼ì ìœ¼ë¡œ `<script>alert(â€™XSSâ€™)</script>` ê°€ ì €ì¥ë©ë‹ˆë‹¤.

3. í•´ë‹¹ ê²Œì‹œê¸€ì„ í™•ì¸í•´ë³´ë©´ ì„±ê³µì ìœ¼ë¡œ XSS ì·¨ì•½ì ì´ ë°œìƒí•˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![image.png](assets/posts/one-day/2025-02-21/image-006.png)

## 5. íŒ¨ì¹˜ ë‚´ìš© ë° ë³€ê²½ì‚¬í•­ ë¶„ì„
```diff
public function __construct() {
-	if ( 1 === (int) SimpleTags_Plugin::get_option_value( 'allow_embed_tcloud' ) ) {
-		add_shortcode( 'st_tag_cloud', array( __CLASS__, 'shortcode' ) );
-		add_shortcode( 'st-tag-cloud', array( __CLASS__, 'shortcode' ) );
-	}
-}
-
-/**
- * Replace marker by a tag cloud in post content, use ShortCode
- *
- * @param array $atts
- *
- * @return string
- */
-public static function shortcode( $atts ) {
-    $atts = shortcode_atts( array( 'param' => '' ), $atts );
-	extract( $atts );
-
-	$param = html_entity_decode( $param );
-	$param = trim( $param );
-
-	if ( empty( $param ) ) {
-		$param = 'title=';
-	}
-
-	return self::extendedTagCloud( $param, false );
}
```

ìœ„ diffë¥¼ í†µí•´ `shortcode()` í•¨ìˆ˜ì—ì„œ ì…ë ¥ ê²€ì¦ì´ ë¶€ì¡±í•´ ì·¨ì•½ì ì´ ë°œìƒí–ˆê³ , ì´í›„ íŒ¨ì¹˜ë²„ì „ì—ì„œ í•´ë‹¹ í•¨ìˆ˜ê°€ ì‚­ì œë˜ì—ˆìŒì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.