---
title: "[CVE-2024-4439] ì·¨ì•½ì  ë¶„ì„ ë³´ê³ ì„œ"
description: "WordPress Coreì˜ 6.5.2 ë²„ì „ ë¯¸ë§Œì—ì„œ ë°œìƒí•˜ëŠ” ì €ì¥í˜• XSS ì·¨ì•½ì "
author: dottak
date: 2024-11-04 01:47:00 +0900
categories: [One-Day ë¶„ì„, WordPress]
tags: [ë¹¡ê³µíŒŸ, ì½˜í…ŒìŠ¤íŠ¸ ë„¤ë·¸ë¼, WordPress, WordPress Core, CVE, CVE-2024-4439]
image:
---

## ğŸ“ Analysis

### 1. ê°œìš”

`CVE-2024-4439`ëŠ” WordPress Coreì˜ 6.5.2 ë²„ì „ ë¯¸ë§Œì—ì„œ ë°œìƒí•˜ëŠ” ì €ì¥í˜• XSS(Stored Cross-Site Scripting) ì·¨ì•½ì ì…ë‹ˆë‹¤.

ìƒˆ ê¸€ ì‘ì„± ì‹œ ì•„ë°”íƒ€ ë¸”ë¡ì„ ì¶”ê°€í•˜ê³ , í•´ë‹¹ ë¸”ë¡ì˜ ì„¤ì •ì„ 'ì‚¬ìš©ì í”„ë¡œí•„ ë§í¬' ë° 'ìƒˆ íƒ­ì—ì„œ ì—´ê¸°'ë¡œ ì§€ì •í•˜ë©´ ì‚¬ìš©ìì˜ í‘œì‹œ ì´ë¦„ì´ ì¶œë ¥ë©ë‹ˆë‹¤. ì´ë•Œ ì¶œë ¥ë˜ëŠ” ê°’ì´ ì ì ˆíˆ ì´ìŠ¤ì¼€ì´í”„ ì²˜ë¦¬ë˜ì§€ ì•Šì•„ XSS ì·¨ì•½ì ì´ ë°œìƒí•©ë‹ˆë‹¤.

### 2. ë°œìƒ ì›ì¸

ì•„ë°”íƒ€ ë¸”ë¡ì˜ ì‚¬ìš©ì í‘œì‹œ ì´ë¦„ì´ ì¶œë ¥ë˜ëŠ” ì½”ë“œëŠ” `wp-includes/blocks/avatar.php` ì— ë‹¤ìŒê³¼ ê°™ì´ êµ¬í˜„ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

> *WordPress Core 6.5 ë²„ì „ì˜ wp-includes/blocks/avatar.php
ref.* [https://github.com/WordPress/WordPress/blob/6.5/wp-includes/blocks/avatar.php#L52](https://github.com/WordPress/WordPress/blob/6.5/wp-includes/blocks/avatar.php#L52)
> 

```php
/* ìƒëµ */
if ( isset( $attributes['isLink'] ) && $attributes['isLink'] ) {
    $label = '';
    if ( '_blank' === $attributes['linkTarget'] ) {
        // translators: %s is the Author name.
        $label = 'aria-label="' . sprintf( esc_attr__( '(%s author archive, opens in a new tab)' ), $author_name ) . '"';
    }
    // translators: %1$s: Author archive link. %2$s: Link target. %3$s Aria label. %4$s Avatar image.
    $avatar_block = sprintf( '<a href="%1$s" target="%2$s" %3$s class="wp-block-avatar__link">%4$s</a>', esc_url( get_author_posts_url( $author_id ) ), esc_attr( $attributes['linkTarget'] ), $label, $avatar_block );
}
/* ìƒëµ */
```

ìœ„ ì½”ë“œì—ì„œ ë³€ìˆ˜ `$label` ì— ëŒ€ì…ë˜ëŠ” ì½”ë“œëŠ” ë‹¤ìŒê³¼ ê°™ì´ êµ¬í˜„ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

```php
$label = 'aria-label="' . sprintf( esc_attr__( '(%s author archive, opens in a new tab)' ), $author_name ) . '"';
```

`sprintf` í•¨ìˆ˜ëŠ” ì„œì‹ ë¬¸ìì—´ `%s` ì— ë³€ìˆ˜ë¥¼ ì‚½ì…í•˜ëŠ” ì—­í• ì„ í•˜ë©°, `esc_attr__` í•¨ìˆ˜ëŠ” ì¸ìë¡œ ì „ë‹¬ëœ ë¬¸ìì—´(`(%s author archive, opens in a new tab)`)ì„ ì´ìŠ¤ì¼€ì´í”„ ì²˜ë¦¬í•˜ì—¬ ì•ˆì „í•˜ê²Œ ì¶œë ¥í•©ë‹ˆë‹¤.

ì¦‰, ì½”ë“œ íë¦„ìƒ `esc_attr__` í•¨ìˆ˜ê°€ ë¨¼ì € í˜¸ì¶œë˜ë¯€ë¡œ ì´ë¯¸ ì´ìŠ¤ì¼€ì´í”„ ì²˜ë¦¬ëœ ë¬¸ìì—´ì— ì‚¬ìš©ì í‘œì‹œ ì´ë¦„ì´ ë‹´ê¸´ ë³€ìˆ˜ `$author_name`ê°€ ì„œì‹ ë¬¸ìì—´ `%s` ì— í¬í•¨ë©ë‹ˆë‹¤.

ë”°ë¼ì„œ, ì‚¬ìš©ì í‘œì‹œ ì´ë¦„ì— ì•…ì„± ìŠ¤í¬ë¦½íŠ¸ê°€ ë‹´ê²¨ì ¸ ìˆì„ ê²½ìš° ì´ìŠ¤ì¼€ì´í”„ ì²˜ë¦¬ê°€ ë˜ì§€ ì•Šìœ¼ë¯€ë¡œ XSS ì·¨ì•½ì ì´ ë°œìƒë©ë‹ˆë‹¤.

### 3. íŒ¨ì¹˜ í™•ì¸

WordPress Core 6.5.1 ë²„ì „ ë¶€í„°ëŠ” ì·¨ì•½ì ì´ ë°œìƒëœ ì½”ë“œê°€ ë‹¤ìŒê³¼ ê°™ì´ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤. ([diff](https://github.com/WordPress/WordPress/commit/66e36c2f18973585f973512bdfa91161d752d5f1#diff-f0927158422e81b2ab428447a5041985765dc99bc3757fe4edf55a0943e50c59R49))

![[https://github.com/WordPress/WordPress/commit/66e36c2f18973585f973512bdfa91161d752d5f1#diff-f0927158422e81b2ab428447a5041985765dc99bc3757fe4edf55a0943e50c59R49](https://github.com/WordPress/WordPress/commit/66e36c2f18973585f973512bdfa91161d752d5f1#diff-f0927158422e81b2ab428447a5041985765dc99bc3757fe4edf55a0943e50c59R49)](assets/posts/one-day/2024-11-04/image-001.png)


ë³€ê²½ëœ ì½”ë“œë¥¼ ì‚´í´ë³´ë©´ ë‹¤ìŒê³¼ ê°™ì´ `sprintf` í•¨ìˆ˜ë¥¼ ë¨¼ì € í˜¸ì¶œí•˜ì—¬ ë³€ìˆ˜ `$author_name` ë¥¼ ì„œì‹ ë¬¸ìì—´ `%s` ì— ì‚½ì…í•œ ë’¤, `esc_attr` í•¨ìˆ˜ì˜ ì¸ìë¡œ ì „ë‹¬í•˜ê³  ìˆìŠµë‹ˆë‹¤.

```php
$label = 'aria-label="' . esc_attr( sprintf( __( '(%s author archive, opens in a new tab)' ), $author_name ) ) . '"';
```

ë”°ë¼ì„œ, ì‚¬ìš©ì í‘œì‹œ ì´ë¦„ì´ ë‹´ê¸´ ë³€ìˆ˜ `$author_name`ì— ì•…ì„± ìŠ¤í¬ë¦½íŠ¸ê°€ í¬í•¨ë˜ë”ë¼ë„ í•¨ìˆ˜ `esc_attr`ì— ì˜í•´ ì´ìŠ¤ì¼€ì´í”„ ì²˜ë¦¬ë˜ë¯€ë¡œ XSS ì·¨ì•½ì ì´ ë” ì´ìƒ ë°œìƒí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

## ğŸ”« POC

> ì´ë¯¸ WordPressê°€ ì„¤ì¹˜ë˜ì–´ ìˆëŠ” ê²½ìš° ë°”ë¡œ â€˜2. XSS í˜ì´ë¡œë“œ ì„¤ì •â€™ ë¡œ ì´ë™í•˜ì…”ë„ ë©ë‹ˆë‹¤ ğŸ™‚

### 1. í™˜ê²½ ì…‹íŒ…(WordPress ì„¤ì¹˜ ë° ì‹¤í–‰)

`CVE-2024-4439` ì— ì˜í–¥ì„ ë°›ëŠ” WordPress 6.5 ë²„ì „ì„ ë‚´ë ¤ë°›ê¸° ìœ„í•´ ì•„ë˜ì˜ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.

```bash
# ì €ì¥ì†Œ í´ë¡ 
$ git clone -b CVE-2024-4439 https://github.com/DoTTak/Research-WordPress.git CVE-2024-4439

# ì‘ì—… ê²½ë¡œ ì´ë™
$ cd CVE-2024-4439

# WordPressì˜ 6.5 ë²„ì „ì„ ë‚´ë ¤ë°›ê¸° ìœ„í•¨
$ git submodule init 
$ git submodule update
```

ì´í›„, `docker-compose` ëª…ë ¹ì„ ì´ìš©í•˜ì—¬ WordPressë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.

```bash
$ docker-compose up
```

ê·¸ ë‹¤ìŒ ë¸Œë¼ìš°ì €ë¥¼ ì´ìš©í•˜ì—¬ `http://localhost:8080` ë¡œ ì´ë™í•œ ë’¤, WordPressë¥¼ ì„¤ì¹˜í•©ë‹ˆë‹¤.

> ì•„ë˜ ìˆœì„œë¥¼ ì°¸ê³ í•˜ì—¬ ì§„í–‰ í•˜ì‹œë©´ ë©ë‹ˆë‹¤.
> 

1. WordPress ì„¤ì¹˜ - ì–¸ì–´ ì„ íƒ
    ![1. WordPress ì„¤ì¹˜ - ì–¸ì–´ ì„ íƒ](assets/posts/one-day/2024-11-04/image-002.png)


2. WordPress ì„¤ì¹˜ - â€˜ì‹œì‘í•©ë‹ˆë‹¤!â€™ í´ë¦­
    ![2. WordPress ì„¤ì¹˜ - â€˜ì‹œì‘í•©ë‹ˆë‹¤!â€™ í´ë¦­](assets/posts/one-day/2024-11-04/image-003.png)


3. WordPress ì„¤ì¹˜ - ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì •
    ![3. WordPress ì„¤ì¹˜ - ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì •](assets/posts/one-day/2024-11-04/image-004.png)


4. WordPress ì„¤ì¹˜ - â€˜ì„¤ì¹˜ ì‹¤í–‰â€™ í´ë¦­
    ![4. WordPress ì„¤ì¹˜ - â€˜ì„¤ì¹˜ ì‹¤í–‰â€™ í´ë¦­](assets/posts/one-day/2024-11-04/image-005.png)


5. WordPress ì„¤ì¹˜ - â€˜ì‚¬ì´íŠ¸ ì •ë³´â€™ ì…ë ¥ í›„ â€˜ì›Œë“œí”„ë ˆìŠ¤ ì„¤ì¹˜â€™ í´ë¦­
    ![5. WordPress ì„¤ì¹˜ - â€˜ì‚¬ì´íŠ¸ ì •ë³´â€™ ì…ë ¥ í›„ â€˜ì›Œë“œí”„ë ˆìŠ¤ ì„¤ì¹˜â€™ í´ë¦­](assets/posts/one-day/2024-11-04/image-006.png)


6. WordPress ì„¤ì¹˜ - â€˜ë¡œê·¸ì¸â€™ í´ë¦­
    ![6. WordPress ì„¤ì¹˜ - â€˜ë¡œê·¸ì¸â€™ í´ë¦­](assets/posts/one-day/2024-11-04/image-007.png)


### 2. XSS í˜ì´ë¡œë“œ ì„¤ì •

ì´ì–´ì„œ ë‚˜ì˜¤ëŠ” ë¡œê·¸ì¸ í˜ì´ì§€ì—ì„œ ì¡°ê¸ˆ ì „ ì…ë ¥ í•œ ì‚¬ìš©ìëª…ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì—¬ ë¡œê·¸ì¸ì„ í•©ë‹ˆë‹¤. ì´í›„, ë‚˜ì˜¤ëŠ” ëŒ€ì‹œë³´ë“œ í™”ë©´ì˜ ì¢Œì¸¡ ì‚¬ì´ë“œë°”ì—ì„œ `ì‚¬ìš©ì > ëª¨ë“  ì‚¬ìš©ì` ë¥¼ í´ë¦­ í•©ë‹ˆë‹¤.

![image.png](assets/posts/one-day/2024-11-04/image-008.png)

ê·¸ëŸ¼ ë°©ê¸ˆ ë¡œê·¸ì¸í•œ ì‚¬ìš©ìì˜ ì •ë³´ê°€ ë‚˜ì˜¤ëŠ”ë° í•´ë‹¹ ì‚¬ìš©ìì˜ â€˜í¸ì§‘â€™ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.

![image.png](assets/posts/one-day/2024-11-04/image-009.png)

ì´í›„ `ì´ë¦„` ë¶€ë¶„ì— ```" onmouseover='alert(`XSS`)' //``` ë¥¼ ì…ë ¥í•˜ê³ , `ê³µê°œì ìœ¼ë¡œ ë³´ì¼ ì´ë¦„` ì— ë°©ê¸ˆ ì…ë ¥í•œ ë‚´ìš©ì„ ì„ íƒí•˜ê³  í”„ë¡œí•„ì„ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.

![image.png](assets/posts/one-day/2024-11-04/image-010.png)

### 3. íŠ¸ë¦¬ê±° ì¤€ë¹„

`http://localhost:8080/wp-admin/post-new.php` ì£¼ì†Œë¡œ ì ‘ì†í•˜ì—¬ ë‹¤ìŒê³¼ ê°™ì´ â€˜ìƒˆ ê¸€ ì¶”ê°€â€™ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2024-10-30 á„‹á…©á„Œá…¥á†« 12.05.13.png](assets/posts/one-day/2024-11-04/image-011.png)

ì´í›„ ë‹¤ìŒê³¼ ê°™ì´ ì•„ë°”íƒ€ ë¸”ë¡ì„ ì„ íƒí•©ë‹ˆë‹¤.

![image.png](assets/posts/one-day/2024-11-04/image-012.png)

ì•„ë°”íƒ€ ë¸”ë¡ì´ ìƒì„±ë˜ë©´ ìš°ì¸¡ ë¸”ë¡ ì„¤ì •ì„ í†µí•´ â€˜ì‚¬ìš©ì í”„ë¡œí•„ë¡œ ê°€ëŠ¥ ë§í¬â€™ ì™€ â€˜ìƒˆ íƒ­ì—ì„œ ì—´ê¸°â€™ë¥¼ í™œì„±í™”í•˜ê³  â€˜ì‚¬ìš©ìâ€™ë€ì— XSS í˜ì´ë¡œë“œë¥¼ ì„ íƒí•œ ë’¤ ìƒë‹¨ì˜ â€˜ê³µê°œâ€™ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ í•´ë‹¹ ê¸€ì„ ê³µê°œí•©ë‹ˆë‹¤.

![image.png](assets/posts/one-day/2024-11-04/image-013.png)

### 4. ìµìŠ¤í”Œë¡œì‡

ì´í›„ ì‘ì„±ëœ ê¸€ë¡œ í˜ì´ì§€ë¥¼ ì´ë™í•œ ë’¤, ì•„ë°”íƒ€ ë¸”ë¡ì— ë§ˆìš°ìŠ¤ë¥¼ ê°€ì ¸ë‹¤ ëŒ€ë©´(`onmouseover`) ë‹¤ìŒê³¼ ê°™ì´ XSS ì·¨ì•½ì ì´ ë°œìƒë˜ì–´ `alert` ì´ ë°œìƒë©ë‹ˆë‹¤.

![image.png](assets/posts/one-day/2024-11-04/image-014.png)
